WITH
MEMBER Measures.[DIFF VENTE] AS '([Measures].[MONTANT HT VENTE]-([Measures].[MONTANT HT VENTE], [DIM TEMPS].[Month Year].CURRENTMEMBER.PrevMember))'
MEMBER Measures.[DIFF MARGE] AS '([Measures].[MARGE BRUTE]-([Measures].[MARGE BRUTE],[DIM TEMPS].[Month Year].CURRENTMEMBER.PrevMember))'

/*
FORMATAGE DU MEMBRE EVOLUTION CA
TRANSFORMATION DES CELLULES N/A EN NULL POUR ENSUITE ELIMINER TOUS LES TUPLES NULL  A TRAVERS LA FONCTION "NON EMPTY"
*/
MEMBER Measures.[Evolution CA] AS 
IIF (ISEMPTY([Measures].[DIFF VENTE]) or ISEMPTY([Measures].[MONTANT HT VENTE]) ,Null ,
	IIF ([Measures].[MONTANT HT VENTE]<=0,0,
		IIF ([Measures].[DIFF VENTE]<>0,[Measures].[DIFF VENTE]/[Measures].[MONTANT HT VENTE],"null"))),FORMAT_STRING="##.#%"

/*
FORMATAGE DU MEMBRE EVOLUTION MARGE
TRANSFORMATION DES CELLULES N/A EN NULL POUR ENSUITE ELIMINER TOUS LES TUPLES NULL  A TRAVERS LA FONCTION "NON EMPTY"
*/

MEMBER Measures.[Evolution Marge] AS 
IIF (ISEMPTY(Measures.[DIFF MARGE]) or ISEMPTY([Measures].[MARGE BRUTE]) ,Null ,
	IIF ([Measures].[MARGE BRUTE]<=0,0,
		IIF (Measures.[DIFF MARGE]<>0,[Measures].[DIFF MARGE]/[Measures].[MARGE BRUTE],"null"))),FORMAT_STRING="##.#%"
--===================================================


 SELECT NON EMPTY {[Measures].[MONTANT HT VENTE],Measures.[Evolution CA],[Measures].[MARGE BRUTE],Measures.[Evolution Marge]} ON COLUMNS, NON EMPTY { ([DIM LIEUX].[NOM DEPARTEMENT MAJ].[NOM DEPARTEMENT MAJ].ALLMEMBERS * [DIM TEMPS].[Month Year].[Month Year].ALLMEMBERS ) } DIMENSION PROPERTIES MEMBER_CAPTION, MEMBER_UNIQUE_NAME ON ROWS FROM ( SELECT ( STRTOSET(@DIMTEMPSMOISNOM, CONSTRAINED) ) ON COLUMNS FROM ( SELECT ( STRTOSET(@DIMVILLESCODEDEPARTEMENT, CONSTRAINED) ) ON COLUMNS FROM [CubeODE])) CELL PROPERTIES VALUE, BACK_COLOR, FORE_COLOR, FORMATTED_VALUE, FORMAT_STRING, FONT_NAME, FONT_SIZE, FONT_FLAGS
