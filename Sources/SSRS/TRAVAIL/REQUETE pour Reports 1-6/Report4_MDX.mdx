WITH
MEMBER Measures.[DIFF VENTE] AS '([Measures].[MONTANT HT VENTE]-([Measures].[MONTANT HT VENTE],  [DIM TEMPS].[Year].CURRENTMEMBER.PrevMember))'

MEMBER Measures.[DIFF MARGE] AS '([Measures].[MARGE BRUTE]-([Measures].[MARGE BRUTE], [DIM TEMPS].[Year].CURRENTMEMBER.PrevMember))'

/*
FORMATAGE DU MEMBRE EVOLUTION CA
TRANSFORMATION DES CELLULES N/A EN NULL POUR ENSUITE ELIMINER TOUS LES TUPLES NULL  A TRAVERS LA FONCTION "NON EMPTY"
*/

MEMBER Measures.[Evolution CA] AS 
IIF (ISEMPTY([Measures].[DIFF VENTE]) or ISEMPTY([Measures].[MONTANT HT VENTE]) ,null,
	IIF ([Measures].[MONTANT HT VENTE]<>0,[Measures].[DIFF VENTE]/[Measures].[MONTANT HT VENTE],"Null")),FORMAT_STRING="##.#%"

/*
FORMATAGE DU MEMBRE EVOLUTION MARGE
TRANSFORMATION DES CELLULES N/A EN NULL POUR ENSUITE ELIMINER TOUS LES TUPLES NULL  A TRAVERS LA FONCTION "NON EMPTY"
*/

MEMBER Measures.[Evolution Marge] AS 
IIF (ISEMPTY(Measures.[DIFF MARGE]) or ISEMPTY([Measures].[MARGE BRUTE]) ,Null ,
	IIF ([Measures].[MARGE BRUTE]<>0,[Measures].[DIFF MARGE]/[Measures].[MARGE BRUTE],"null")),FORMAT_STRING="##.#%"
--===================================================


 SELECT NON EMPTY {[Measures].[MONTANT HT VENTE],Measures.[Evolution CA],[Measures].[MARGE BRUTE],Measures.[Evolution Marge]} ON COLUMNS, 
NON EMPTY { ([DIM LIEUX].[NOM DEPARTEMENT MAJ].[NOM DEPARTEMENT MAJ].ALLMEMBERS * [DIM TEMPS].[Year].[Year].ALLMEMBERS ) } DIMENSION PROPERTIES MEMBER_CAPTION, MEMBER_UNIQUE_NAME ON ROWS FROM ( SELECT ( STRTOSET(@DIMTEMPSANNEENOM, CONSTRAINED) ) ON COLUMNS FROM ( SELECT ( STRTOSET(@DEPARTEMENT, CONSTRAINED) ) ON COLUMNS FROM [CubeODE])) CELL PROPERTIES VALUE
